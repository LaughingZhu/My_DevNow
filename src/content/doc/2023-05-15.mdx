---
title: 小程序-永久码加群实现
desc: 记录数独杯小程序开发中，如何实现用户永久加群二维码，避免运营定期更新的烦恼。
publishDate: '2023-05-15'
image: https://cdn.laughingzhu.cn/b2116da5-2270-4938-ba70-15f8d29638aa.png
category: blog
author: LaughingZhu
tags: [Blog, 小程序]
---

# 背景

最近在写和伙伴一起搞的 #数独杯 项目时想实现一个让用户加群的功能，用户点击按钮时加入到我们的 **数独杯用户群**。记录一下我们的迭代方案和遇到的问题。

# 迭代方案

## 方案一：小程序群二维码

我们第一版的方案是在微信里新建了一个 **数独杯用户群**，然后新增了一个关于我们的页面展示，文案+图片，引导用户入群，如下图：![1095c824-6f4f-4d69-b0df-0b0bafe2b05e](https://cdn.laughingzhu.cn/1095c824-6f4f-4d69-b0df-0b0bafe2b05e.png)
然后就出现了我们遇到的 #第一个问题: **微信群二维码7天过期**
然后就是围绕着7天过期寻求解决方案，我们最后采取的方案是通过一个配置后台，每周定时去cdn上上传一个 微信群二维码，然后更新配置后台，这周的二维码就可以正常使用了；第一周很顺利，但是周末忘了更新入群二维码，导致二维码失效，这个在后续的一段时间里经常忘记，也定过闹钟，可能当时忙然后放一放就忘了😂。然后就开始寻求新的解决方案。

## 方案二：微信公众号

为了简化方案一种存在的两个问题

### （一）微信群二维码7天有效期

第二版的方案中暂时没有找到微信群二维码的解决方案，后边的中心放在了优化问题二的方案上。

### （二）群二维码 -> cdn -> 配置中心流程太繁琐

这里尝试了去掉配置中心，通过公众号来配置一个群二维码图片，然后通过公众号去配置自定义消息，然后发现总的流程基本没有变化，线路依然很长，只是把配置中心配置改成了公众号消息和文章配置。

## 方案三：企微活码

方案二在开发中就否定了，然后寻求其他的方案，总的来说还是希望流程简化、群二维码长期有效。

在找了很多文章后发现企业微信群二维码可以长期有效，虽然写着七天有效，但是每天打开都是显示7天，**这里可能引起误解，但是是长期有效的**。

群二维码过期的问题解决了，然后就是如何在小程序上让用户入群的问题。其实这里就回到了方案一、方案二。两个方案都可以，之前卡在了微信二维码过期上，现在不过期了，两个流程虽然一样长，但是只需要配置一次就可以了。到这里我以为两个问题都解决了，只是我以为。。。😂

### 新的问题来了

企业微信群二维码无论是通过公众号文章还是直接在小程序中通过Image引入，都无法实现长按识别二维码的功能，后来发现这个是小程序这边做了限制，目前仅支持[支持码](https://developers.weixin.qq.com/miniprogram/dev/component/image.html)：
![91bf63df-a365-4942-afe5-702636fd5364](https://cdn.laughingzhu.cn/91bf63df-a365-4942-afe5-702636fd5364.png)

虽然可以让用户截图在识别，这样用户体验和整体的链路就又变长了。

### 最终解决方案来了：

申请一个企微的公司账号，然后通过 [加入群聊小程序按钮](https://developer.work.weixin.qq.com/document/path/93884) 来实现。这样虽然增加了一天研发成本，但是之前遇到的问题就都解决了。

- 微信二维码失效: 企微群二维码（永久有效）
- 配置流程较长： 原先微信群二维码->cdn -> 配置后台 ---------> 微信第三方小程序插件实现。

这样以来所有的问题就都解决了。这里有个小问题就是这个组件的样式问题：

![2b62a9f4-3dd8-47af-bdbb-0a69bf3bd4c2](https://cdn.laughingzhu.cn/2b62a9f4-3dd8-47af-bdbb-0a69bf3bd4c2.png)

目前仅支持变就和圆角的配置，为了和我们已有的以后保持一致。通过将按钮透明，绝对定位层级放到最高，层级下放已有的按钮样式。这样就可以完美实现了
